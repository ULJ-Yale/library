{
  "name": "qunex-turnkey-initial-hcp1-hcp5-QC-uploadstudy-cleanup",
  "label": "QUNEX TURNKEY initial, hcp1-hcp5, QC, DATA CLEANUP WITH FULL STUDY UPLOAD",
  "description": "Runs QuNex Turnkey all steps w/ full study upload",
  "version": "1.20",
  "schema-version": "1.0",
  "info-url": "https://bitbucket.org/oriadev/qunex/wiki/Home",
  "image": "qunex/qunex_suite:[TAG]",
  "type": "docker",
  "working-directory": "/output",
  "command-line": "/opt/qunex/library/etc/xnat/cs-wrapper.sh #BATCH_PARAMETERS_FILENAME_ARG# #TURNKEYSTEPS_ARG# #OVERWRITESTEP_ARG# #OVERWRITEPROJECTXNAT_ARG# #SCAN_MAPPING_FILENAME_ARG# #ID# #LABEL# #XNAT_PROJECT# #SUBJECTID#",
  "mounts": [
    {
      "name": "in",
      "writable": false,
      "path": "/input"
    },
    {
      "name": "out",
      "writable": true,
      "path": "/output"
    }
  ],
  "environment-variables": {},
  "ports": {},
  "inputs": [
    {
      "name": "batch_parameters_filename",
      "label": null,
      "description": "Name of the batch parameters file. This file is expected to be present at the QUNEX_PROC resource at the project level",
      "type": "string",
      "matcher": null,
      "default-value": "batch_parameters.txt",
      "required": true,
      "replacement-key": "#BATCH_PARAMETERS_FILENAME_ARG#",
      "sensitive": null,
      "command-line-flag": "--batchfile",
      "command-line-separator": "=",
      "true-value": null,
      "false-value": null,
      "select-values": [],
      "multiple-delimiter": null
    },
    {
      "name": "scan_mapping_filename",
      "label": null,
      "description": "Name of the scan mapping file. This file is expected to be present at the QUNEX_PROC resource at the project level",
      "type": "string",
      "matcher": null,
      "default-value": "hcp_mapping.txt",
      "required": true,
      "replacement-key": "#SCAN_MAPPING_FILENAME_ARG#",
      "sensitive": null,
      "command-line-flag": "--mappingfile",
      "command-line-separator": "=",
      "true-value": null,
      "false-value": null,
      "select-values": [],
      "multiple-delimiter": null
    },
    {
      "name": "session_id",
      "label": null,
      "description": "Session Accession ID",
      "type": "string",
      "matcher": null,
      "default-value": null,
      "required": true,
      "replacement-key": "#ID#",
      "sensitive": null,
      "command-line-flag": "--xnataccsessionid",
      "command-line-separator": "=",
      "true-value": null,
      "false-value": null,
      "select-values": [],
      "multiple-delimiter": null
    },
    {
      "name": "session_label",
      "label": null,
      "description": "Session Label",
      "type": "string",
      "matcher": null,
      "default-value": null,
      "required": true,
      "replacement-key": "#LABEL#",
      "sensitive": null,
      "command-line-flag": "--xnatsessionlabels",
      "command-line-separator": "=",
      "true-value": null,
      "false-value": null,
      "select-values": [],
      "multiple-delimiter": null
    },
    {
      "name": "session_project",
      "label": null,
      "description": "Project ID of the session",
      "type": "string",
      "matcher": null,
      "default-value": null,
      "required": true,
      "replacement-key": "#XNAT_PROJECT#",
      "sensitive": null,
      "command-line-flag": "--xnatprojectid",
      "command-line-separator": "=",
      "true-value": null,
      "false-value": null,
      "select-values": [],
      "multiple-delimiter": null
    },
    {
      "name": "session_subject",
      "label": null,
      "description": "Subject ID of the Session",
      "type": "string",
      "matcher": null,
      "default-value": null,
      "required": true,
      "replacement-key": "#SUBJECTID#",
      "sensitive": null,
      "command-line-flag": "--xnatsubjectid",
      "command-line-separator": "=",
      "true-value": null,
      "false-value": null,
      "select-values": [],
      "multiple-delimiter": null
    },
    {
      "name": "overwritestep",
      "label": null,
      "description": "Flag to decide if a specific step is to be overwritten by QuNex scripts",
      "type": "string",
      "matcher": null,
      "default-value": "no",
      "required": true,
      "replacement-key": "#OVERWRITESTEP_ARG#",
      "sensitive": null,
      "command-line-flag": "--overwritestep",
      "command-line-separator": "=",
      "true-value": null,
      "false-value": null,
      "select-values": [],
      "multiple-delimiter": null
    },
    {
      "name": "cleanup",
      "label": null,
      "description": "Flag to decide if the data is to be cleaned up after all turnkey steps",
      "type": "string",
      "matcher": null,
      "default-value": "yes",
      "required": true,
      "replacement-key": "#CLEANUP_ARG#",
      "sensitive": null,
      "command-line-flag": "--cleanup",
      "command-line-separator": "=",
      "true-value": null,
      "false-value": null,
      "select-values": [],
      "multiple-delimiter": null
    },
    {
      "name": "turnkeysteps",
      "label": null,
      "description": "Steps to execute",
      "type": "string",
      "matcher": null,
      "default-value": "createStudy,mapRawData,importDICOM,createSessionInfo,setupHCP,createBatch,hcp1,hcp2,hcp3,runQC_T1w,runQC_T2w,runQC_Myelin,hcp4,hcp5,runQC_BOLD",
      "required": true,
      "replacement-key": "#TURNKEYSTEPS_ARG#",
      "sensitive": null,
      "command-line-flag": "--turnkeysteps",
      "command-line-separator": "=",
      "true-value": null,
      "false-value": null,
      "select-values": [],
      "multiple-delimiter": null
    },
    {
      "name": "overwriteprojectxnat",
      "label": null,
      "description": "Flag to decide if the entire XNAT project is to be deleted before start",
      "type": "string",
      "matcher": null,
      "default-value": "no",
      "required": true,
      "replacement-key": "#OVERWRITEPROJECTXNAT_ARG#",
      "sensitive": null,
      "command-line-flag": "--overwriteprojectxnat",
      "command-line-separator": "=",
      "true-value": null,
      "false-value": null,
      "select-values": [],
      "multiple-delimiter": null
    }
  ],
  "outputs": [
    {
      "name": "qunex_study",
      "description": null,
      "required": false,
      "mount": "out",
      "path": "#XNAT_PROJECT#",
      "glob": null
    },
    {
      "name": "QC",
      "description": null,
      "required": false,
      "mount": "out",
      "path": "#XNAT_PROJECT#/subjects/QC",
      "glob": null
    }
  ],
  "xnat": [
    {
      "name": "qunex-xnat-turnkey-all_steps-0.62.7_xcon",
      "label": null,
      "description": "Execute QuNex Turnkey 0.62.7_xcon hcp2-hcp5-QC",
      "contexts": [
        "xnat:imageSessionData"
      ],
      "external-inputs": [
        {
          "name": "session",
          "label": null,
          "description": "Input session",
          "type": "Session",
          "matcher": null,
          "default-value": null,
          "required": true,
          "replacement-key": null,
          "sensitive": null,
          "provides-value-for-command-input": null,
          "provides-files-for-command-mount": "in",
          "via-setup-command": null,
          "user-settable": null,
          "load-children": true
        }
      ],
      "derived-inputs": [
        {
          "name": "id",
          "label": null,
          "description": "Session Accession ID. Used as QuNex id variable.",
          "type": "string",
          "matcher": null,
          "default-value": null,
          "required": true,
          "replacement-key": null,
          "sensitive": null,
          "provides-value-for-command-input": "session_id",
          "provides-files-for-command-mount": null,
          "user-settable": null,
          "load-children": true,
          "derived-from-wrapper-input": "session",
          "derived-from-xnat-object-property": "id",
          "via-setup-command": null,
          "multiple": false
        },
        {
          "name": "label",
          "label": null,
          "description": "Session label. Used as QuNex subject identifier.",
          "type": "string",
          "matcher": null,
          "default-value": null,
          "required": true,
          "replacement-key": null,
          "sensitive": null,
          "provides-value-for-command-input": "session_label",
          "provides-files-for-command-mount": null,
          "user-settable": null,
          "load-children": true,
          "derived-from-wrapper-input": "session",
          "derived-from-xnat-object-property": "label",
          "via-setup-command": null,
          "multiple": false
        },
        {
          "name": "xnat_project",
          "label": null,
          "description": "Project in which session is stored",
          "type": "string",
          "matcher": null,
          "default-value": null,
          "required": true,
          "replacement-key": null,
          "sensitive": null,
          "provides-value-for-command-input": "session_project",
          "provides-files-for-command-mount": null,
          "user-settable": null,
          "load-children": true,
          "derived-from-wrapper-input": "session",
          "derived-from-xnat-object-property": "project-id",
          "via-setup-command": null,
          "multiple": false
        },
        {
          "name": "subjectid",
          "label": null,
          "description": "Subject Accession ID",
          "type": "string",
          "matcher": null,
          "default-value": null,
          "required": true,
          "replacement-key": null,
          "sensitive": null,
          "provides-value-for-command-input": "session_subject",
          "provides-files-for-command-mount": null,
          "user-settable": null,
          "load-children": true,
          "derived-from-wrapper-input": "session",
          "derived-from-xnat-object-property": "subject-id",
          "via-setup-command": null,
          "multiple": false
        }
      ],
      "output-handlers": [
        {
          "name": "output-resource-study",
          "accepts-command-output": "qunex_study",
          "via-wrapup-command": null,
          "as-a-child-of": "session",
          "type": "Resource",
          "label": "qunex_study",
          "format": null
        },
        {
          "name": "output-resource-qc",
          "accepts-command-output": "QC",
          "via-wrapup-command": null,
          "as-a-child-of": "session",
          "type": "Resource",
          "label": "QC",
          "format": null
        }
      ]
    }
  ],
  "reserve-memory": 15000
}
