{
  "name": "qunex-turnkey-bids-initial-hcp1-5-QC-BOLDfc-uploadstudy-cleanup",
  "label": "QUNEX BIDS-COMPLIANT TURNKEY INITIAL, HCP1-5, QC, BOLD FC & DATA CLEANUP WITH FULL STUDY UPLOAD",
  "description": "Runs QuNex BIDS-compliant Turnkey initial, HCP1-5 & QC, BOLD fc w/ full study upload",
  "version": "1.10",
  "schema-version": "1.0",
  "info-url": "https://bitbucket.org/oriadev/qunex",
  "image": "qunex/qunex_suite:<replace with image tag in use>",
  "type": "docker",
  "working-directory": "/output",
  "command-line": "/opt/qunex/library/etc/qunexParse.sh #COMMAND_ARG# #BIDSFORMAT_ARG# #BATCH_PARAMETERS_FILENAME_ARG# #TURNKEYSTEPS_ARG# #OVERWRITESTEP_ARG# #OVERWRITEPROJECTPATHFINDER_ARG# #SCAN_MAPPING_FILENAME_ARG# #ID# #LABEL# #PATHFINDER_PROJECT# #SUBJECTID#",
  "mounts": [
    {
      "name": "in",
      "writable": false,
      "path": "/input"
    },
    {
      "name": "out",
      "writable": true,
      "path": "/output"
    }
  ],
  "environment-variables": {},
  "ports": {},
  "inputs": [
    {
      "name": "qunex_command",
      "description": "Name of the QuNex command to run.",
      "type": "string",
      "matcher": null,
      "default-value": "runTurnkey",
      "required": true,
      "replacement-key": "#COMMAND_ARG#",
      "sensitive": null,
      "command-line-flag": "--command",
      "command-line-separator": "=",
      "true-value": null,
      "false-value": null
    },
    {
      "name": "bids_format",
      "description": "Specify if files are in BIDS format",
      "type": "string",
      "matcher": null,
      "default-value": "yes",
      "required": true,
      "replacement-key": "#BIDSFORMAT_ARG#",
      "command-line-flag": "--bidsformat",
      "command-line-separator": "=",
      "true-value": null,
      "false-value": null
    },
    {
      "name": "batch_parameters_filename",
      "description": "Name of the batch parameters file. This file is expected to be present at the QUNEX_PROC resource at the project level",
      "type": "string",
      "matcher": null,
      "default-value": "batch_parameters.txt",
      "required": true,
      "replacement-key": "#BATCH_PARAMETERS_FILENAME_ARG#",
      "sensitive": null,
      "command-line-flag": "--batchfile",
      "command-line-separator": "=",
      "true-value": null,
      "false-value": null
    },
    {
      "name": "scan_mapping_filename",
      "description": "Name of the scan mapping file. This file is expected to be present at the QUNEX_PROC resource at the project level",
      "type": "string",
      "matcher": null,
      "default-value": "hcp_mapping.txt",
      "required": true,
      "replacement-key": "#SCAN_MAPPING_FILENAME_ARG#",
      "sensitive": null,
      "command-line-flag": "--mappingfile",
      "command-line-separator": "=",
      "true-value": null,
      "false-value": null
    },
    {
      "name": "overwritestep",
      "description": "Flag to decide if a specific step is to be overwritten by qunex scripts",
      "type": "string",
      "matcher": null,
      "default-value": "yes",
      "required": true,
      "replacement-key": "#OVERWRITESTEP_ARG#",
      "sensitive": null,
      "command-line-flag": "--overwritestep",
      "command-line-separator": "=",
      "true-value": null,
      "false-value": null
    },
    {
      "name": "cleanup",
      "description": "Flag to decide if the data is to be cleaned up after all turnkey steps",
      "type": "string",
      "matcher": null,
      "default-value": "yes",
      "required": true,
      "replacement-key": "#CLEANUP_ARG#",
      "sensitive": null,
      "command-line-flag": "--cleanup",
      "command-line-separator": "=",
      "true-value": null,
      "false-value": null
    },
    {
      "name": "turnkeysteps",
      "description": "Steps to execute",
      "type": "string",
      "matcher": null,
      "default-value": "createStudy,mapRawData,createSessionInfo,setupHCP,createBatch,hcp1,hcp2,hcp3,runQC_T1w,runQC_T2w,runQC_Myelin,hcp4,hcp5,runQC_BOLD,mapHCPData,createBOLDBrainMasks,computeBOLDStats,createStatsReport,extractNuisanceSignal,preprocessBold,BOLDParcellation,computeBOLDfcSeed,computeBOLDfcGBC",
      "required": true,
      "replacement-key": "#TURNKEYSTEPS_ARG#",
      "sensitive": null,
      "command-line-flag": "--turnkeysteps",
      "command-line-separator": "=",
      "true-value": null,
      "false-value": null
    }
  ],
  "outputs": [
    {
      "name": "qunex_study",
      "description": null,
      "required": false,
      "mount": "out",
      "path": "#PATHFINDER_PROJECT#",
      "glob": null
    },
    {
      "name": "QC",
      "description": null,
      "required": false,
      "mount": "out",
      "path": "#PATHFINDER_PROJECT#/sessions/QC",
      "glob": null
    }
  ],
  "pathfinder": [
    {
      "name": "qunex-bids-init-to-hcp5-QC-BOLDfc",
      "label": null,
      "description": "Execute QuNex BIDS-compliant Turnkey initial, hcp1-5 with QC, BOLD fc with full study upload and data cleanup",
      "contexts": [
        "pathfinder:imageSessionData"
      ],
      "external-inputs": [
        {
          "name": "session",
          "description": "Input session",
          "type": "Session",
          "matcher": null,
          "default-value": null,
          "required": true,
          "replacement-key": null,
          "sensitive": null,
          "provides-value-for-command-input": null,
          "provides-files-for-command-mount": "in",
          "via-setup-command": null,
          "user-settable": null,
          "load-children": true
        }
      ],
      "derived-inputs": [
        {
          "name": "database_session_id",
          "description": "Unique database session ID.",
          "type": "string",
          "matcher": null,
          "default-value": null,
          "required": true,
          "replacement-key": null,
          "sensitive": null,
          "provides-value-for-command-input": "database_session_id",
          "provides-files-for-command-mount": null,
          "user-settable": null,
          "load-children": true,
          "derived-from-wrapper-input": "session",
          "derived-from-pathfinder-object-property": "id",
          "via-setup-command": null
        },
        {
          "name": "qunex_session_id",
          "description": "Unique session ID within the project. Used as QuNex session identifier.",
          "type": "string",
          "matcher": null,
          "default-value": null,
          "required": true,
          "replacement-key": null,
          "sensitive": null,
          "provides-value-for-command-input": "session_label",
          "provides-files-for-command-mount": null,
          "user-settable": null,
          "load-children": true,
          "derived-from-wrapper-input": "session",
          "derived-from-pathfinder-object-property": "label",
          "via-setup-command": null
        },
        {
          "name": "qunex_project",
          "description": "Project in which the session is stored",
          "type": "string",
          "matcher": null,
          "default-value": null,
          "required": true,
          "replacement-key": null,
          "sensitive": null,
          "provides-value-for-command-input": "session_project",
          "provides-files-for-command-mount": null,
          "user-settable": null,
          "load-children": true,
          "derived-from-wrapper-input": "session",
          "derived-from-pathfinder-object-property": "project-id",
          "via-setup-command": null
        },
        {
          "name": "database_subjectid",
          "description": "Unique subject ID",
          "type": "string",
          "matcher": null,
          "default-value": null,
          "required": true,
          "replacement-key": null,
          "sensitive": null,
          "provides-value-for-command-input": "session_subject",
          "provides-files-for-command-mount": null,
          "user-settable": null,
          "load-children": true,
          "derived-from-wrapper-input": "session",
          "derived-from-pathfinder-object-property": "subject-id",
          "via-setup-command": null
        }
      ],
      "output-handlers": [
        {
          "name": "output-resource-study",
          "description": "Database resource for QuNex processed data",
          "accepts-command-output": "qunex_study",
          "via-wrapup-command": null,
          "as-a-child-of": "session",
          "type": "Resource",
          "label": "pathfinder_study"
        },
        {
          "name": "output-resource-qc",
          "description": "Database resource for QuNex QC",
          "accepts-command-output": "QC",
          "via-wrapup-command": null,
          "as-a-child-of": "session",
          "type": "Resource",
          "label": "QC"
        }
      ]
    }
  ],
  "reserve-memory": 15000
}